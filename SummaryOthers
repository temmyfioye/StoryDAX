//Executive summary
execsummary = "Data Warehouse project for client."&UNICHAR(10) // this is a comment, unichar(10) means next line
&UNICHAR(10)&
"The Content of this report is as follows:"&UNICHAR(10)&UNICHAR(10)&
"1. The Total distinct number of merchants between "&FORMAT(max('productdb'[TRANS_DATE] ),"MMMM")&" "&FORMAT(MAX('productdb'[TRANS_DATE]),"yyyy")&" is "&FORMAT(DISTINCTCOUNT('productdb merchant'[UNIQUE_MERCHANT]),"#,##")&"." 
//FORMAT(max('productdb'[TRANS_DATE] ),"MMMM") gets the month of the last transaction date while "yyyy" gets the year 
&FORMAT(DISTINCTCOUNT('C_Merchant(Trim)'[UNIQUE_MERCHANT]),"#,##" gets the unique merchant count and puts a , if the value is in thousands.
&UNICHAR(10)&UNICHAR(10)&
"2. Merchant records which are segmented into "&FORMAT(DISTINCTCOUNT('productdb merchant'[SECTOR]),"#,##")&"  sectors with their respective category and subcategory." //  "&FORMAT(DISTINCTCOUNT('C_Merchant(Trim)'[SECTOR]),"#,##") gets the total number of distinct merchants
&UNICHAR(10)&UNICHAR(10)&
"3. The Value of Transaction each Unique Merchant Generated."
&UNICHAR(10)&UNICHAR(10)&
"4. The Overall Market Share across sectors and Volume of Transaction generated by supporting banks for a "&DISTINCTCOUNT('Calendar Table'[Month_Name])&" month period from "&FORMAT(MIN('productdb'[TRANS_DATE]),"MMMM YYYY")&" to "&FORMAT(MAX('productdb'[TRANS_DATE]),"MMMM YYYY")&"." //&DISTINCTCOUNT(dim_date[Month_Name]) gets the total number of unique transaction months, &FORMAT(MIN(TRANSACTION_PRODUCT[TRANS_DATE]),"MMMM YYYY") gets the minimum month and year, FORMAT(CALCULATE(DATEADD(LASTDATE(TRANSACTION_PAYOUTLET[TRANS_DATE]), -1,MONTH)),"MMMM YYYY") gets the maximum month and year less one month
&UNICHAR(10)&UNICHAR(10)&
"5. The Position Value of banks based on the Total Volume of Transactions by Merchants for a "&DISTINCTCOUNT('Calendar Table'[Month_Name])&" month period from "&FORMAT(MIN('productdb'[TRANS_DATE]),"MMMM YYYY")&" to "&FORMAT(MAX('productdb'[TRANS_DATE]),"MMMM YYYY")&"." 
&UNICHAR(10)&UNICHAR(10)&
"6. The Monthly Trend of the  Value and Volume of Transactions by Profiled Merchants for a "&DISTINCTCOUNT('Calendar Table'[Month_Name])&" month period from "&FORMAT(MIN('productdb'[TRANS_DATE]),"MMMM YYYY")&" to "&FORMAT(MAX('productdb'[TRANS_DATE]),"MMMM YYYY")&"." 
&UNICHAR(10)&UNICHAR(10)&
"7. Customer loyalty Analysis on profiled Merchants and Banks  for "&FORMAT(MAX('productdb'[TRANS_DATE]),"MMMM YYYY")&"." 
&UNICHAR(10)&UNICHAR(10)&
"8. Behavioural Analysis on profiled Merchants for "&FORMAT(MAX('productdb'[TRANS_DATE]),"MMMM YYYY")&"." 
&UNICHAR(10)&UNICHAR(10)&
"9.  Opportunity and Risk Analysis on profiled Merchants and Banks  for "&FORMAT(MAX('productdb'[TRANS_DATE]),"MMMM YYYY")&"." 
&UNICHAR(10)&UNICHAR(10)&
"10. New potential opportunities on profiled Merchants for "&FORMAT(MAX('productdb'[TRANS_DATE]),"MMMM YYYY")&"." 

//count of unique merchants
SectorRank =
VAR highestsectortbl =
    SUMMARIZE('productdb merchant','productdb merchant'[SECTOR],
    "HighestSector", DISTINCTCOUNT('productdb merchant'[UNIQUE_MERCHANT])
    )
VAR highestsectorval = MAXX(
    SUMMARIZE('productdb merchant','productdb merchant'[SECTOR],
    "HighestSector",DISTINCTCOUNT('productdb merchant'[UNIQUE_MERCHANT])
    ),
[HighestSector]
)
 VAR highsector = CALCULATE(MAXX(FILTER(highestsectortbl, [HighestSector] = highestsectorval), 'productdb merchant'[SECTOR]))
VAR lowestsectortbl =
    SUMMARIZE('productdb merchant','productdb merchant'[SECTOR],
    "LowestSector", DISTINCTCOUNT('productdb merchant'[UNIQUE_MERCHANT])
    )
VAR lowestsectorval = MINX(
    SUMMARIZE('productdb merchant','productdb merchant'[SECTOR],
    "LowestSector", DISTINCTCOUNT('productdb merchant'[UNIQUE_MERCHANT])
    ),
[LowestSector]
)
VAR lowestsector = CALCULATE(MINX(FILTER(lowestsectortbl,[LowestSector]=lowestsectorval),'productdb merchant'[SECTOR])
)
RETURN
"Out of a total of "&FORMAT(DISTINCTCOUNT('productdb merchant'[UNIQUE_MERCHANT]),"#,##")&" Unique Merchants "&
"in "&SELECTEDVALUE('Calendar Table'[Month_Name],"selected period")&", the "&highsector&" Sector ranks highest with a total of "&FORMAT(highestsectorval,"#,##")&" unique merchants, while the "&lowestsector&" ranks lowest with a total of "&FORMAT(lowestsectorval,"#,##")&" unique merchants."

//unique merchant by volume of transaction
SectorRankVol =
VAR highestsectortbl =
    SUMMARIZE('productdb merchant','productdb merchant'[SECTOR],
    "HighestSector", COUNTROWS('productdb trans_merchant_master')
    )
VAR highestsectorval = MAXX(
    SUMMARIZE('productdb merchant','productdb merchant'[SECTOR],
    "HighestSector", COUNTROWS('payoutletdb trans_merchant_master')
    ),
[HighestSector]
)
VAR highestsectormerchanttbl =
    SUMMARIZE('productdb merchant','productdb merchant'[UNIQUE_MERCHANT],
    "HighestSectorM", COUNTROWS('payoutletdb trans_merchant_master')
    )
VAR highestsectormerchantval = MAXX(
    SUMMARIZE('productdb merchant','productdb merchant'[UNIQUE_MERCHANT],
    "HighestSectorM", COUNTROWS('payoutletdb trans_merchant_master')
    ),
[HighestSectorM]
)
 VAR highsector = CALCULATE(MAXX(FILTER(highestsectortbl, [HighestSector] = highestsectorval), 'productdb merchant'[SECTOR]))
 VAR highsectorM = CALCULATE(MAXX(FILTER(highestsectormerchanttbl, [HighestSectorM] = highestsectormerchantval), 'productdb merchant'[UNIQUE_MERCHANT]))
RETURN
"In "&SELECTEDVALUE('Calendar Table'[Month_Name],"the selected period")&
", the "&highsector&" sector ranks highest with a total transaction volume of "&
if(highestsectorval<=1000, FORMAT(highestsectorval,"#,##"),
    if(highestsectorval<=999999,FORMAT(highestsectorval/1000,"#.0K"),
        IF(highestsectorval<=999999999,FORMAT(highestsectorval/1000000,"#.0M"),
            IF(highestsectorval<=999999999999,FORMAT(highestsectorval/1000000000,"#.0bn"),
                if(highestsectorval>=1000000000000,FORMAT(highestsectorval/1000000000000,"#.0tn"))))))
&" across all sectors."&
UNICHAR(10)&
"The Merchant-"&highsectorM&"-generated the highest transaction volume of "&
if(highestsectormerchantval<=1000, FORMAT(highestsectormerchantval,"#,##"),
    if(highestsectormerchantval<=999999,FORMAT(highestsectormerchantval/1000,"#.0K"),
        IF(highestsectormerchantval<=999999999,FORMAT(highestsectormerchantval/1000000,"#.0M"),
            IF(highestsectormerchantval<=999999999999,FORMAT(highestsectormerchantval/1000000000,"#.0bn"),
                if(highestsectormerchantval>=1000000000000,FORMAT(highestsectormerchantval/1000000000000,"#.0tn"))))))
&" across all unique merchants."


//unique merchant by value of transaction
SectorRankVal =
VAR highestsectortbl =
    SUMMARIZE('productdb merchant','productdb merchant'[SECTOR],
    "HighestSector",'#Measures'[Total Value of Transaction]
    )
VAR highestsectorval = MAXX(
    SUMMARIZE('productdb merchant','productdb merchant'[SECTOR],
    "HighestSector", '#Measures'[Total Value of Transaction]
    ),
[HighestSector]
)
VAR highestsectormerchanttbl =
    SUMMARIZE('productdb merchant','productdb merchant'[UNIQUE_MERCHANT],
    "HighestSectorM", '#Measures'[Total Value of Transaction]
    )
VAR highestsectormerchantval = MAXX(
    SUMMARIZE('productdb merchant','productdb merchant'[UNIQUE_MERCHANT],
    "HighestSectorM", '#Measures'[Total Value of Transaction]
    ),
[HighestSectorM]
)
 VAR highsector = CALCULATE(MAXX(FILTER(highestsectortbl, [HighestSector] = highestsectorval), 'productdb merchant'[SECTOR]))
 VAR highsectorM = CALCULATE(MAXX(FILTER(highestsectormerchanttbl, [HighestSectorM] = highestsectormerchantval), 'productdb merchant'[UNIQUE_MERCHANT]))
RETURN
"In "&SELECTEDVALUE('Calendar Table'[Month_Name],"the selected period")&
", the "&highsector&" sector ranks highest with a total transaction value of "&
if(highestsectorval<=1000, FORMAT(highestsectorval,"₦#,##"),
    if(highestsectorval<=999999,FORMAT(highestsectorval/1000,"₦#.0K"),
        IF(highestsectorval<=999999999,FORMAT(highestsectorval/1000000,"₦#.0M"),
            IF(highestsectorval<=999999999999,FORMAT(highestsectorval/1000000000,"₦#.0bn"),
                if(highestsectorval>=1000000000000,FORMAT(highestsectorval/1000000000000,"₦#.0tn"))))))
&" across all sectors."&
UNICHAR(10)&
"The Merchant-"&highsectorM&"-generated the highest transaction volume of "&
if(highestsectormerchantval<=1000, FORMAT(highestsectormerchantval,"₦#,##"),
    if(highestsectormerchantval<=999999,FORMAT(highestsectormerchantval/1000,"₦#.0K"),
        IF(highestsectormerchantval<=999999999,FORMAT(highestsectormerchantval/1000000,"₦#.0M"),
            IF(highestsectormerchantval<=999999999999,FORMAT(highestsectormerchantval/1000000000,"₦#.0bn"),
                if(highestsectormerchantval>=1000000000000,FORMAT(highestsectormerchantval/1000000000000,"₦#.0tn"))))))
&" across all unique merchants."
 
//volume of transaction by bank and sector
VolbybankSector =
VAR highestsectortbl =
    SUMMARIZE('productdb merchant','productdb merchant'[SECTOR],
    "HighestSector", COUNTROWS('productdb merchant')
    )
VAR highestsectorval = MAXX(
    SUMMARIZE('productdb merchant','productdb merchant'[SECTOR],
    "HighestSector", COUNTROWS('productdb merchant')
    ),
[HighestSector]
)
VAR highestbanktbl =
    SUMMARIZE('productdb merchant','productdb merchant'[BANK_NAME],
    "HighestSectorBank", CALCULATE(COUNTROWS('productdb merchant'),FILTER('productdb merchant','productdb merchant'[BANK_NAME]<>"Unnamed"))
    )
// CALCULATE(COUNTROWS('productdb merchant'),FILTER('productdb merchant','productdb merchant'[BANK_NAME]<>"Unnamed")
VAR highestsectorbankval = MAXX(
    SUMMARIZE('productdb merchant','productdb merchant'[BANK_NAME],
    "HighestSectorBank",CALCULATE(COUNTROWS('productdb merchant'),FILTER('productdb merchant','productdb merchant'[BANK_NAME]<>"Unnamed"))
    ),
[HighestSectorBank]
)
 VAR highsector = CALCULATE(MAXX(FILTER(highestsectortbl, [HighestSector] = highestsectorval), 'productdb merchant'[SECTOR]))
 VAR highsectorbank = CALCULATE(MAXX(FILTER(highestbanktbl, [HighestSectorBank] = highestsectorbankval), 'productdb merchant'[BANK_NAME]))
RETURN
"In "&SELECTEDVALUE('Calendar Table'[Month_Name],"the selected period")&
" for "&SELECTEDVALUE('productdb merchant'[BANK_NAME],"the selected banks")&
", the "&highsector&" sector ranks highest with a total transaction volume of "&
if(highestsectorval<=1000, FORMAT(highestsectorval,"#,##"),
    if(highestsectorval<=999999,FORMAT(highestsectorval/1000,"#.0K"),
        IF(highestsectorval<=999999999,FORMAT(highestsectorval/1000000,"#.0M"),
            IF(highestsectorval<=999999999999,FORMAT(highestsectorval/1000000000,"#.0bn"),
                if(highestsectorval>=1000000000000,FORMAT(highestsectorval/1000000000000,"#.0tn"))))))
&" across all sectors."
&UNICHAR(10)
&highsectorbank&" is the banked that ranked highest with a total transaction volume of "&
if(highestsectorbankval<=1000, FORMAT(highestsectorbankval,"#,##"),
    if(highestsectorbankval<=999999,FORMAT(highestsectorbankval/1000,"#.0K"),
        IF(highestsectorbankval<=999999999,FORMAT(highestsectorbankval/1000000,"#.0M"),
            IF(highestsectorbankval<=999999999999,FORMAT(highestsectorbankval/1000000000,"#.0bn"),
                if(highestsectorbankval>=1000000000000,FORMAT(highestsectorbankval/1000000000000,"#.0tn"))))))
&" for the identified banks."
 
//unidentified banks market share
UnnamedBanks =
VAR mktshare =CALCULATE(COUNTROWS('productdb merchant'),FILTER('productdb merchant','productdb merchant'[BANK_NAME]="Unnamed"))
RETURN
"In "&SELECTEDVALUE('Calendar Table'[Month_Name],"the selected period")&" "&
if(mktshare<=1000, FORMAT(mktshare,"#,##"),
    if(mktshare<=999999,FORMAT(mktshare/1000,"#.0K"),
        IF(mktshare<=999999999,FORMAT(mktshare/1000000,"#.0M"),
            IF(mktshare<=999999999999,FORMAT(mktshare/1000000000,"#.0bn"),
                if(mktshare>=1000000000000,FORMAT(mktshare/1000000000000,"#.0tn"))))))&
" of the total volume of transactions have no identified bank where transaction occurred. They are categorized as Unnamed."
 
//identified banks market share
Identifiedbanksval =
//trans_merchant_master
VAR highestbanktbl =
    SUMMARIZE('productdb merchant','productdb merchant'[BANK_NAME],
    "HighestSectorBank", CALCULATE(sum('productdb merchant'[TRANS_AMOUNT]),FILTER('productdb merchant','productdb merchant'[BANK_NAME]<>"Unnamed"))
    )
VAR highestsectorbankval = MAXX(
    SUMMARIZE('productdb merchant','productdb merchant'[BANK_NAME],
    "HighestSectorBank", CALCULATE(sum('productdb merchant'[TRANS_AMOUNT]),FILTER('productdb merchant','productdb merchant'[BANK_NAME]<>"Unnamed"))
    ),
[HighestSectorBank]
)
VAR lowestbanktbl =
    SUMMARIZE('productdb merchant','productdb merchant'[BANK_NAME],
    "LowestSectorBank", CALCULATE(sum('productdb merchant'[TRANS_AMOUNT]),FILTER('productdb merchant','productdb merchant'[BANK_NAME]<>"Unnamed"))
    )
VAR lowestsectorbankval = MINX(
    SUMMARIZE('productdb merchant','productdb merchant'[BANK_NAME],
    "LowestSectorBank", CALCULATE(sum('productdb merchant'[TRANS_AMOUNT]),FILTER('productdb merchant','productdb merchant'[BANK_NAME]<>"Unnamed"))
    ),
[LowestSectorBank]
)
 VAR highsectorbank = CALCULATE(MAXX(FILTER(highestbanktbl, [HighestSectorBank] = highestsectorbankval), 'productdb merchant'[BANK_NAME]))
VAR lowsectorbank = CALCULATE(MINX(FILTER(lowestbanktbl, [LowestSectorBank] = lowestsectorbankval), 'productdb merchant'[BANK_NAME]))
RETURN
"In terms of Market share for the identified banks and in "&SELECTEDVALUE('Calendar Table'[Month_Name],"the selected period ")
&highsectorbank&" ranked highest with a total transaction value of "&
if(highestsectorbankval<=1000, FORMAT(highestsectorbankval,"₦#,##"),
    if(highestsectorbankval<=999999,FORMAT(highestsectorbankval/1000,"₦#.0K"),
        IF(highestsectorbankval<=999999999,FORMAT(highestsectorbankval/1000000,"₦#.0M"),
            IF(highestsectorbankval<=999999999999,FORMAT(highestsectorbankval/1000000000,"₦#.0bn"),
                if(highestsectorbankval>=1000000000000,FORMAT(highestsectorbankval/1000000000000,"₦#.0tn"))))))
&", while "&
lowsectorbank&" ranked lowest with a total transaction value of "&
if(lowestsectorbankval<=1000, FORMAT(lowestsectorbankval,"₦#,##"),
    if(lowestsectorbankval<=999999,FORMAT(lowestsectorbankval/1000,"₦#.0K"),
        IF(lowestsectorbankval<=999999999,FORMAT(lowestsectorbankval/1000000,"₦#.0M"),
            IF(lowestsectorbankval<=999999999999,FORMAT(lowestsectorbankval/1000000000,"₦#.0bn"),
                if(lowestsectorbankval>=1000000000000,FORMAT(lowestsectorbankval/1000000000000,"₦#.0tn"))))))
 
//monthly volume trend
Volumetrend =
  VAR HighTableVol =
    SUMMARIZE('productdb merchant','Calendar Table'[MonthNAME_YEAR],
    "HighestMonthVol",COUNTROWS('productdb merchant')
    )
VAR HighestMthVol = MAXX(
    SUMMARIZE(
       'productdb merchant','Calendar Table'[MonthNAME_YEAR],
       "HighestMonthVol",COUNTROWS('productdb merchant')
    ),
  [HighestMonthVol]
)
  VAR LowTableVol =
    SUMMARIZE('productdb merchant','Calendar Table'[MonthNAME_YEAR],
    "LowestMonthVol",COUNTROWS('productdb merchant')
    )
VAR LowestMthVol = MINX(
    SUMMARIZE(
       'productdb merchant','Calendar Table'[MonthNAME_YEAR],
       "LowestMonthVol",COUNTROWS('productdb merchant')
    ),
  [LowestMonthVol]
)
RETURN
CALCULATE(MAXX(FILTER(HighTableVol, [HighestMonthVol] = HighestMthVol), FORMAT('Calendar Table'[MonthNAME_YEAR],"MMM YYYY")&
" recorded the highest transaction volume at "&
if(HighestMthVol<=1000, FORMAT(HighestMthVol,"#,##"),
    if(HighestMthVol<=999999,FORMAT(HighestMthVol/1000,"#.0K"),
        IF(HighestMthVol<=999999999,FORMAT(HighestMthVol/1000000,"#.0M"),
            IF(HighestMthVol<=999999999999,FORMAT(HighestMthVol/1000000000,"#.0bn"),
                if(HighestMthVol>=1000000000000,FORMAT(HighestMthVol/1000000000000,"#.0tn"))))))))&
", while "&
CALCULATE(MINX(FILTER(LowTableVol, [LowestMonthVol] = LowestMthVol), FORMAT('Calendar Table'[MonthNAME_YEAR],"MMM YYYY")&
" recorded the lowest transaction volume at "&
if(LowestMthVol<=1000, FORMAT(LowestMthVol,"#,##"),
    if(LowestMthVol<=999999,FORMAT(LowestMthVol/1000,"#.0K"),
        IF(LowestMthVol<=999999999,FORMAT(LowestMthVol/1000000,"#.0M"),
            IF(LowestMthVol<=999999999999,FORMAT(LowestMthVol/1000000000,"#.0bn"),
                if(LowestMthVol>=1000000000000,FORMAT(LowestMthVol/1000000000000,"#.0tn"))))))))

//monthly value trend
Valuetrend =
  VAR HighTableVal =
    SUMMARIZE('productdb merchant','Calendar Table'[MonthNAME_YEAR],
    "HighestMonthVal",sum('productdb merchant'[TRANS_AMOUNT])
    )
VAR HighestMthVal = MAXX(
    SUMMARIZE(
       'productdb merchant','Calendar Table'[MonthNAME_YEAR],
       "HighestMonthVal",sum('productdb merchant'[TRANS_AMOUNT])
    ),
  [HighestMonthVal]
)
  VAR LowTableVal =
    SUMMARIZE('productdb merchant','Calendar Table'[MonthNAME_YEAR],
    "LowestMonthVal",sum('productdb merchant'[TRANS_AMOUNT])
    )
VAR LowestMthVal = MINX(
    SUMMARIZE(
       'productdb merchant','Calendar Table'[MonthNAME_YEAR],
       "LowestMonthVal",sum('productdb merchant'[TRANS_AMOUNT])
    ),
  [LowestMonthVal]
)
RETURN
CALCULATE(MAXX(FILTER(HighTableVal, [HighestMonthVal] = HighestMthVal), FORMAT('Calendar Table'[MonthNAME_YEAR],"MMM YYYY")&
" recorded the highest transaction value at "&
if(HighestMthVal<=1000, FORMAT(HighestMthVal,"₦#,##"),
    if(HighestMthVal<=999999,FORMAT(HighestMthVal/1000,"₦#.0K"),
        IF(HighestMthVal<=999999999,FORMAT(HighestMthVal/1000000,"₦#.0M"),
            IF(HighestMthVal<=999999999999,FORMAT(HighestMthVal/1000000000,"₦#.0bn"),
                if(HighestMthVal>=1000000000000,FORMAT(HighestMthVal/1000000000000,"₦#.0tn"))))))))&
", while "&
CALCULATE(MINX(FILTER(LowTableVal, [LowestMonthVal] = LowestMthVal), FORMAT('Calendar Table'[MonthNAME_YEAR],"MMM YYYY")&
" recorded the lowest transaction value at "&
if(LowestMthVal<=1000, FORMAT(LowestMthVal,"₦#,##"),
    if(LowestMthVal<=999999,FORMAT(LowestMthVal/1000,"₦#.0K"),
        IF(LowestMthVal<=999999999,FORMAT(LowestMthVal/1000000,"₦#.0M"),
            IF(LowestMthVal<=999999999999,FORMAT(LowestMthVal/1000000000,"₦#.0bn"),
                if(LowestMthVal>=1000000000000,FORMAT(LowestMthVal/1000000000000,"₦#.0tn"))))))))

Revenuedeepdiveval =
VAR higheststategovttbl =
    SUMMARIZE('productdb','productdb'[Unique_Merchant],
    "highestmerchant", CALCULATE(sum('productdb'[TRANS_AMOUNT]),FILTER('productdb','productdb'[Category]="State Government"))
    )
VAR higheststateval = MAXX(
 SUMMARIZE('productdb','productdb'[Unique_Merchant],
    "highestmerchant", CALCULATE(sum('productdb'[TRANS_AMOUNT]),FILTER('productdb','productdb'[Category]="State Government"))
    ),
[highestmerchant]
)
VAR loweststategovttbl =
     SUMMARIZE('productdb','productdb'[Unique_Merchant],
    "lowestmerchant", CALCULATE(sum('productdb'[TRANS_AMOUNT]),FILTER('productdb','productdb'[Category]="State Government"))
    )
VAR loweststateval = MINX(
 SUMMARIZE('productdb','productdb'[Unique_Merchant],
    "lowestmerchant", CALCULATE(sum('productdb'[TRANS_AMOUNT]),FILTER('productdb','productdb'[Category]="State Government"))
    ),
[lowestmerchant]
)
 VAR highigrmerchant = CALCULATE(MAXX(FILTER(higheststategovttbl, [highestmerchant] = higheststateval), 'productdb'[Unique_Merchant]))
VAR lowigrmerchant = CALCULATE(MINX(FILTER(loweststategovttbl, [lowestmerchant] = loweststateval), 'productdb'[Unique_Merchant]))
RETURN
"In "&SELECTEDVALUE('Calendar Table'[Month_Name],"the selected period")&", "&highigrmerchant&" had the highest value of total transactions at "&
if(higheststateval<=1000, FORMAT(higheststateval,"₦#,##"),
    if(higheststateval<=999999,FORMAT(higheststateval/1000,"₦#.0K"),
        IF(higheststateval<=999999999,FORMAT(higheststateval/1000000,"₦#.0M"),
            IF(higheststateval<=999999999999,FORMAT(higheststateval/1000000000,"₦#.0bn"),
                if(higheststateval>=1000000000000,FORMAT(higheststateval/1000000000000,"₦#.0tn"))))))
&", while "&
lowigrmerchant&" had the lowest value of total transactions at "&
if(loweststateval<=1000, FORMAT(loweststateval,"₦#,##"),
    if(loweststateval<=999999,FORMAT(loweststateval/1000,"₦#.0K"),
        IF(loweststateval<=999999999,FORMAT(loweststateval/1000000,"₦#.0M"),
            IF(loweststateval<=999999999999,FORMAT(loweststateval/1000000000,"₦#.0bn"),
                if(loweststateval>=1000000000000,FORMAT(loweststateval/1000000000000,"₦#.0tn"))))))&"."
//Revenue deep dive volume
Revenuedeepdivevol =
VAR higheststategovttbl =
    SUMMARIZE('productdb','productdb'[Unique_Merchant],
    "highestmerchant", CALCULATE(COUNT('payoutletdb igr'[UNIQUE_MERCHANT]),FILTER('productdb','productdb'[Category]="State Government"))
    )
VAR higheststatevol = MAXX(
 SUMMARIZE('productdb','productdb'[Unique_Merchant],
    "highestmerchant", CALCULATE(COUNT('payoutletdb igr'[UNIQUE_MERCHANT]),FILTER('productdb','productdb'[Category]="State Government"))
    ),
[highestmerchant]
)
VAR loweststategovttbl =
     SUMMARIZE('productdb','productdb'[Unique_Merchant],
    "lowestmerchant", CALCULATE(COUNT('payoutletdb igr'[UNIQUE_MERCHANT]),FILTER('productdb','productdb'[Category]="State Government"))
    )
VAR loweststatevol = MINX(
 SUMMARIZE('productdb','productdb'[Unique_Merchant],
    "lowestmerchant", CALCULATE(COUNT('payoutletdb igr'[UNIQUE_MERCHANT]),FILTER('productdb','productdb'[Category]="State Government"))
    ),
[lowestmerchant]
)
 VAR highigrmerchant = CALCULATE(MAXX(FILTER(higheststategovttbl, [highestmerchant] = higheststatevol), 'productdb'[Unique_Merchant]))
VAR lowigrmerchant = CALCULATE(MINX(FILTER(loweststategovttbl, [lowestmerchant] = loweststatevol), 'productdb'[Unique_Merchant]))
RETURN
"For transaction volume, "&highigrmerchant&" had the highest volume of transactions at "&
if(higheststatevol<=1000, FORMAT(higheststatevol,"#,##"),
    if(higheststatevol<=999999,FORMAT(higheststatevol/1000,"#.0K"),
        IF(higheststatevol<=999999999,FORMAT(higheststatevol/1000000,"#.0M"),
            IF(higheststatevol<=999999999999,FORMAT(higheststatevol/1000000000,"#.0bn"),
                if(higheststatevol>=1000000000000,FORMAT(higheststatevol/1000000000000,"#.0tn"))))))
&", while "&
lowigrmerchant&" had the lowest volume of transactions at "&
if(loweststatevol<=1000, FORMAT(loweststatevol,"#,##"),
    if(loweststatevol<=999999,FORMAT(loweststatevol/1000,"#.0K"),
        IF(loweststatevol<=999999999,FORMAT(loweststatevol/1000000,"#.0M"),
            IF(loweststatevol<=999999999999,FORMAT(loweststatevol/1000000000,"#.0bn"),
                if(loweststatevol>=1000000000000,FORMAT(loweststatevol/1000000000000,"#.0tn"))))))&"."

//monthly Customer loyalty on profiled merchants
CLsummary1 =
VAR mthcount = COUNT('productdb merchant_cl_analysis'[Unique Merchant])
 
VAR poorcount = if(
        CALCULATE(COUNTROWS('productdb merchant_cl_analysis'),FILTER('productdb merchant_cl_analysis','productdb merchant_cl_analysis'[Loyalty class]="04_Poor"))=BLANK(), "No transactions",
    CALCULATE(COUNTROWS('productdb merchant_cl_analysis'),FILTER('productdb merchant_cl_analysis','productdb merchant_cl_analysis'[Loyalty class]="04_Poor")
))
 
VAR irregularcount = if(CALCULATE(COUNTROWS('productdb merchant_cl_analysis'),FILTER('productdb merchant_cl_analysis','productdb merchant_cl_analysis'[Loyalty class]="03_Irregular"))=BLANK(),"No transactions",CALCULATE(COUNTROWS('productdb merchant_cl_analysis'),FILTER('productdb merchant_cl_analysis','productdb merchant_cl_analysis'[Loyalty class]="03_Irregular")))
 
VAR regularcount = if(CALCULATE(COUNTROWS('productdb merchant_cl_analysis'),FILTER('productdb merchant_cl_analysis','productdb merchant_cl_analysis'[Loyalty class]="02_Regular"))=BLANK(),"No transactions",CALCULATE(COUNTROWS('productdb merchant_cl_analysis'),FILTER('productdb merchant_cl_analysis','productdb merchant_cl_analysis'[Loyalty class]="02_Regular")))
 
VAR dailycount = if(CALCULATE(COUNTROWS('productdb merchant_cl_analysis'),FILTER('productdb merchant_cl_analysis','productdb merchant_cl_analysis'[Loyalty class]="01_Daily"))=BLANK(),"No transactions",CALCULATE(COUNTROWS('productdb merchant_cl_analysis'),FILTER('productdb merchant_cl_analysis','productdb merchant_cl_analysis'[Loyalty class]="01_Daily")))
 
RETURN
"From the "&mthcount&" Merchants that transacted in "&SELECTEDVALUE('productdb merchant_cl_analysis'[Month_])&":"&
UNICHAR(10)&"--->"&poorcount&" performed transaction between 1-7 days"&
UNICHAR(10)&"--->"&irregularcount&" performed transactions between 7 and 14 days"&
UNICHAR(10)&"--->"&regularcount&" performed transactions between 15-24 days, and "&
UNICHAR(10)&"--->"&dailycount&" performed transactions for more than 24 days."
&UNICHAR(10)&"Each Loyalty class will require a different approach in order rejig activity on the Unique Merchants."


//Loyalty class
clmerchantcnt =
if(COUNT('productdb merchant_cl_analysis'[Unique Merchant]) = BLANK(),"No unique merchants for the selected period and sector",
    VAR HighSectorTbl =
    SUMMARIZE('productdb merchant_cl_analysis','productdb merchant_cl_analysis'[Sector],
    "Highest sector",COUNT('productdb merchant_cl_analysis'[Unique Merchant])
    )
VAR HighSectorVal = MAXX(
    SUMMARIZE('productdb merchant_cl_analysis','productdb merchant_cl_analysis'[Sector],
    "Highest sector",COUNT('productdb merchant_cl_analysis'[Unique Merchant])
    ),
  [Highest Sector]
)
 VAR LowSectorTbl =
    SUMMARIZE('productdb merchant_cl_analysis','productdb merchant_cl_analysis'[Sector],
    "Lowest sector",COUNT('productdb merchant_cl_analysis'[Unique Merchant])
    )
VAR LowSectorVal = MINX(
    SUMMARIZE('productdb merchant_cl_analysis','productdb merchant_cl_analysis'[Sector],
    "Lowest sector",COUNT('productdb merchant_cl_analysis'[Unique Merchant])
    ),
  [Lowest Sector]
)
RETURN
"In "&
SELECTEDVALUE('productdb merchant_cl_analysis'[Month_],"the selected period")&
" the sector with the highest number of unique merchant count is "&CALCULATE(MAXX(FILTER(HighSectorTbl, [Highest Sector] = HighSectorVal), 'productdb merchant_cl_analysis'[SECTOR]))
&" at "& HighSectorVal&" unique merchants, while the sector with the lowest number of unique merchant count is "
&CALCULATE(MAXX(FILTER(LowSectorTbl, [Lowest Sector] = LowSectorVal), 'productdb merchant_cl_analysis'[SECTOR])
&" at "&LowSectorVal&" unique merchant(s)."
))//Opportunity and Risk Analysis Merchant count
oramerchant = "This segmentation classifies customers based on the recency of activity generated by the customers. It groups all Unique Merchants and analyzes relative performance."
&UNICHAR(10)&
"Out of the "&DISTINCTCOUNT('productdb'[Unique_Merchant])&" merchants, only "&DISTINCTCOUNT('productdb_3_month_tx'[UNIQUE_MERCHANT_CODE])&" merchants transacted at least once once  in the past 3 months"
&UNICHAR(10)&
"Each ORA segment will require a different approach in order ignite activity on the Unique Merchants."




 
//Opportunity and Risk Analysis Merchant count
oramerchant = "This segmentation classifies customers based on the recency of activity generated by the customers. It groups all Unique Merchants and analyzes relative performance."
&UNICHAR(10)&
"Out of the "&DISTINCTCOUNT('productdb'[Unique_Merchant])&" merchants, only "&DISTINCTCOUNT('productdb_3_month_tx'[UNIQUE_MERCHANT_CODE])&" merchants transacted at least once once  in the past 3 months"
&UNICHAR(10)&
"Each ORA segment will require a different approach in order ignite activity on the Unique Merchants."


transactingmonthcnt = "Count of Unique Merchants that transacted in the past "&DISTINCTCOUNT('Calendar Table'[Month])&" Months."


//Behavioural Analysis profiled merchant
BAprofiledMerchantSum =
"From the " &'productdb ba_merchant'[bauniqueMerchantCnt]&" merchant(s) that transacted within the past "& 'productdb ba_merchant'[bacntmthyear]&" month(s), for"&SELECTEDVALUE('productdb ba_merchant'[Sector]," the selected sectors")&", below is the break down of unique merchants that transacted for different periods."

//ba summary
baSummary =
if(DISTINCTCOUNT('productdb ba_merchant'[Unique Merchant]) = BLANK(),"No merchant transacted",
DISTINCTCOUNT('productdb ba_merchant'[Unique Merchant]) & " merchants transacted")
 
//ba Sector performance
baSectorPerformance =
IF('productdb ba_merchant'[bauniqueMerchantCnt]=BLANK(),
"No transactions for the selected sector(s)",
    VAR HighSectorTbl =
    SUMMARIZE('productdb ba_merchant','productdb ba_merchant'[Sector],
    "Highest sector",'productdb ba_merchant'[bauniqueMerchantCnt]
    )
VAR HighSectorVal = MAXX(
    SUMMARIZE(
        'productdb ba_merchant','productdb ba_merchant'[Sector],
    "Highest sector",'productdb ba_merchant'[bauniqueMerchantCnt]
    ),
  [Highest Sector]
)
    VAR LowSectorTbl =
    SUMMARIZE('productdb ba_merchant','productdb ba_merchant'[Sector],
    "Lowest sector",'productdb ba_merchant'[bauniqueMerchantCnt]
)
VAR LowSectorVal = MINX(
    SUMMARIZE(
       'productdb ba_merchant','productdb ba_merchant'[Sector],
    "Lowest sector",'productdb ba_merchant'[bauniqueMerchantCnt]
    ),
  [Lowest Sector]
)
RETURN
"The sector with the highest number of unique merchant count is "&CALCULATE(MAXX(FILTER(HighSectorTbl, [Highest Sector] = HighSectorVal), 'productdb ba_merchant'[Sector])
&" at "& HighSectorVal&", while the sector with the lowest number of unique merchant is "&CALCULATE(minx(FILTER(LowSectorTbl, [Lowest Sector] = LowSectorVal), 'productdb ba_merchant'[Sector])&" at "&LowSectorVal&" merchant(s)."
)))


